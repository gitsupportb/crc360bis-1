<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Reporting Dashboard â€“ Enhanced Version</title>
  <style>
    :root {
      --primary-color: #2563eb;
      --primary-hover: #1d4ed8;
      --secondary-color: #64748b;
      --success-color: #059669;
      --warning-color: #d97706;
      --danger-color: #dc2626;
      --background-color: #f8fafc;
      --card-background: #ffffff;
      --border-color: #e2e8f0;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      color: var(--text-primary);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: var(--card-background);
      border-radius: 16px;
      box-shadow: var(--shadow-lg);
      overflow: hidden;
    }

    h1 {
      text-align: center;
      margin: 0;
      padding: 30px 20px;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
      color: white;
      font-size: 2.5rem;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Date selector styling */
    .date-selector {
      background: var(--card-background);
      padding: 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .date-selector label {
      font-weight: 600;
      color: var(--text-primary);
    }

    .date-selector select, .date-selector input {
      padding: 8px 12px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 14px;
      background: white;
      transition: border-color 0.3s ease;
    }

    .date-selector select:focus, .date-selector input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }

    .btn-success {
      background: var(--success-color);
      color: white;
    }

    .btn-success:hover {
      background: #047857;
      transform: translateY(-1px);
    }

    /* Top-level tabs */
    .top-tabs {
      overflow: hidden;
      background: var(--card-background);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      flex-wrap: wrap;
    }

    .top-tablinks {
      background: transparent;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 16px 24px;
      transition: all 0.3s ease;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      border-bottom: 3px solid transparent;
      flex: 1;
      min-width: 200px;
    }

    .top-tablinks:hover {
      background: #f1f5f9;
      color: var(--text-primary);
    }

    .top-tablinks.active {
      background: #f1f5f9;
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
      font-weight: 600;
    }

    .top-tabcontent {
      display: none;
      padding: 0;
      background: var(--card-background);
    }

    /* Nested (sub-) tabs */
    .sub-tabs {
      overflow: hidden;
      background: #f8fafc;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      flex-wrap: wrap;
      padding: 0 20px;
    }

    .sub-tablinks {
      background: transparent;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 12px 20px;
      transition: all 0.3s ease;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      border-radius: 8px 8px 0 0;
      margin-right: 4px;
      margin-top: 8px;
    }

    .sub-tablinks:hover {
      background: var(--card-background);
      color: var(--text-primary);
    }

    .sub-tablinks.active {
      background: var(--card-background);
      color: var(--primary-color);
      font-weight: 600;
      box-shadow: 0 -2px 4px rgba(0,0,0,0.05);
    }

    .sub-tabcontent {
      display: none;
      padding: 20px;
      background: var(--card-background);
    }

    /* Table styling */
    .table-container {
      overflow-x: auto;
      border-radius: 12px;
      box-shadow: var(--shadow);
      margin-top: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      background: white;
    }

    th, td {
      padding: 12px 8px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    th {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      font-weight: 600;
      color: var(--text-primary);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    tr:hover {
      background: #f8fafc;
    }

    .toggle-checkbox {
      transform: scale(1.3);
      accent-color: var(--success-color);
    }

    /* Plotly container */
    .progress-chart {
      width: 100%;
      height: 400px;
      margin-bottom: 20px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    /* Module d'upload */
    #uploadSection {
      border: 2px dashed var(--border-color);
      border-radius: 12px;
      padding: 30px;
      margin: 20px;
      background: var(--card-background);
      text-align: center;
      transition: border-color 0.3s ease;
    }

    #uploadSection:hover {
      border-color: var(--primary-color);
    }

    #uploadSection h2 {
      color: var(--text-primary);
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 15px;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .form-group select, .form-group input {
      width: 100%;
      padding: 10px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s ease;
    }

    .form-group select:focus, .form-group input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    /* Monthly tasks specific styling */
    .monthly-tasks-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .download-btn {
      background: var(--success-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .download-btn:hover {
      background: #047857;
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }

    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-completed {
      background: #dcfce7;
      color: #166534;
    }

    .status-pending {
      background: #fef3c7;
      color: #92400e;
    }

    .status-overdue {
      background: #fee2e2;
      color: #991b1b;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      h1 {
        font-size: 2rem;
        padding: 20px;
      }

      .top-tablinks, .sub-tablinks {
        font-size: 12px;
        padding: 12px 16px;
      }

      .sub-tabcontent {
        padding: 15px;
      }

      table {
        font-size: 12px;
      }

      th, td {
        padding: 8px 6px;
      }
    }
  </style>
  <!-- Include Plotly.js and html2canvas for image export -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Reporting Dashboard - Enhanced</h1>

    <!-- Enhanced Date selector -->
    <div class="date-selector">
      <label for="daySelector">Day:</label>
      <select id="daySelector">
        <!-- Days will be populated dynamically -->
      </select>

      <label for="monthSelector">Month:</label>
      <select id="monthSelector">
        <option value="1">January</option>
        <option value="2">February</option>
        <option value="3">March</option>
        <option value="4">April</option>
        <option value="5">May</option>
        <option value="6">June</option>
        <option value="7">July</option>
        <option value="8">August</option>
        <option value="9">September</option>
        <option value="10">October</option>
        <option value="11">November</option>
        <option value="12">December</option>
      </select>

      <label for="yearSelector">Year:</label>
      <select id="yearSelector">
        <option value="2020">2020</option>
        <option value="2021">2021</option>
        <option value="2022">2022</option>
        <option value="2023">2023</option>
        <option value="2024">2024</option>
        <option value="2025" selected>2025</option>
        <option value="2026">2026</option>
        <option value="2027">2027</option>
        <option value="2028">2028</option>
        <option value="2029">2029</option>
      </select>

      <button id="updateDateButton" class="btn btn-primary">Update Date</button>
    </div>

    <!-- Module d'upload -->
    <div id="uploadSection">
      <h2>Upload Reporting File</h2>
      <div class="form-group">
        <label for="reportSelect">Select Report:</label>
        <select id="reportSelect">
          <!-- Options added dynamically -->
        </select>
      </div>
      <div class="form-group">
        <label for="fileInput">Select File:</label>
        <input type="file" id="fileInput">
      </div>
      <button id="uploadButton" class="btn btn-success">Upload File</button>
      <span id="uploadStatus"></span>
    </div>

    <!-- Main tabs -->
    <div class="top-tabs">
      <button class="top-tablinks" onclick="openTopTab(event, 'cat1')" id="defaultTopTab">I â€“ Situation comptable et Ã©tats annexes</button>
      <button class="top-tablinks" onclick="openTopTab(event, 'cat2')">II â€“ Etats de synthÃ¨se et documents qui leur sont complÃ©mentaires</button>
      <button class="top-tablinks" onclick="openTopTab(event, 'cat3')">III â€“ Etats relatifs Ã  la rÃ©glementation prudentielle</button>
      <button class="top-tablinks" onclick="openTopTab(event, 'progressAll')">Progression Overview</button>
    </div>

    <!-- CATEGORY I -->
    <div id="cat1" class="top-tabcontent">
      <div class="sub-tabs">
        <button class="sub-tablinks" onclick="openSubTab(event, 'cat1_upcoming')" id="defaultSubTab_cat1">Upcoming Events</button>
        <button class="sub-tablinks" onclick="openSubTab(event, 'cat1_reports')">All Reports</button>
        <button class="sub-tablinks" onclick="openSubTab(event, 'cat1_monthly')">This Month Tasks</button>
      </div>

      <div id="cat1_upcoming" class="sub-tabcontent">
        <h2>Upcoming Events â€“ Situation comptable et Ã©tats annexes</h2>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Code</th>
                <th>Appellation</th>
                <th>Frequency</th>
                <th>Transmission</th>
                <th>Deadline Rule</th>
                <th>Date d'arrÃªtÃ©</th>
                <th>Deadline</th>
                <th>Days Remaining</th>
              </tr>
            </thead>
            <tbody id="upcoming-table-cat1">
              <!-- Rows generated dynamically -->
            </tbody>
          </table>
        </div>
      </div>

      <div id="cat1_reports" class="sub-tabcontent">
        <h2>All Reports â€“ Situation comptable et Ã©tats annexes</h2>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Code</th>
                <th>Appellation</th>
                <th>Frequency</th>
                <th>Transmission</th>
                <th>Deadline Rule</th>
                <th>Date d'arrÃªtÃ©</th>
                <th>Deadline</th>
                <th>Days Remaining</th>
                <th>Toggle</th>
                <th>Progress (%)</th>
              </tr>
            </thead>
            <tbody id="reports-table-cat1">
              <!-- Rows generated dynamically -->
            </tbody>
          </table>
        </div>
      </div>

      <div id="cat1_monthly" class="sub-tabcontent">
        <div class="monthly-tasks-header">
          <h2>Evenement de presentation du comitÃ© risk mensuelle - Category I</h2>
          <button onclick="downloadTableAsImage('monthly-table-cat1')" class="download-btn">
            ðŸ“¥ Download as Image
          </button>
        </div>
        <div class="table-container">
          <table id="monthly-table-cat1">
            <thead>
              <tr>
                <th>Code</th>
                <th>Appellation</th>
                <th>Status</th>
                <th>Deadline</th>
                <th>Priority</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody id="monthly-tasks-cat1">
              <!-- Monthly tasks generated dynamically -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Similar structure for Categories II and III would go here -->
    <!-- For brevity, I'll add a simplified version -->

    <div id="cat2" class="top-tabcontent">
      <div class="sub-tabs">
        <button class="sub-tablinks" onclick="openSubTab(event, 'cat2_upcoming')" id="defaultSubTab_cat2">Upcoming Events</button>
        <button class="sub-tablinks" onclick="openSubTab(event, 'cat2_reports')">All Reports</button>
        <button class="sub-tablinks" onclick="openSubTab(event, 'cat2_monthly')">This Month Tasks</button>
      </div>
      <div id="cat2_upcoming" class="sub-tabcontent">
        <h2>Category II - Coming Soon</h2>
        <p>Similar structure to Category I</p>
      </div>
      <div id="cat2_reports" class="sub-tabcontent">
        <h2>Category II Reports - Coming Soon</h2>
      </div>
      <div id="cat2_monthly" class="sub-tabcontent">
        <h2>Category II Monthly Tasks - Coming Soon</h2>
      </div>
    </div>

    <div id="cat3" class="top-tabcontent">
      <div class="sub-tabs">
        <button class="sub-tablinks" onclick="openSubTab(event, 'cat3_upcoming')" id="defaultSubTab_cat3">Upcoming Events</button>
        <button class="sub-tablinks" onclick="openSubTab(event, 'cat3_reports')">All Reports</button>
        <button class="sub-tablinks" onclick="openSubTab(event, 'cat3_monthly')">This Month Tasks</button>
      </div>
      <div id="cat3_upcoming" class="sub-tabcontent">
        <h2>Category III - Coming Soon</h2>
        <p>Similar structure to Category I</p>
      </div>
      <div id="cat3_reports" class="sub-tabcontent">
        <h2>Category III Reports - Coming Soon</h2>
      </div>
      <div id="cat3_monthly" class="sub-tabcontent">
        <h2>Category III Monthly Tasks - Coming Soon</h2>
      </div>
    </div>

    <!-- PROGRESSION OVERVIEW -->
    <div id="progressAll" class="top-tabcontent">
      <div style="padding: 20px;">
        <h2>Progression Overview (Yearly Completion %)</h2>
        <div id="progress-bars-cat1" class="progress-chart"></div>
        <div id="progress-bars-cat2" class="progress-chart"></div>
        <div id="progress-bars-cat3" class="progress-chart"></div>
      </div>
    </div>
  </div>

  <!-- JavaScript Code -->
  <script>
    // Tab Functions
    function openTopTab(evt, tabName) {
      var contents = document.getElementsByClassName("top-tabcontent");
      for (var i = 0; i < contents.length; i++) { contents[i].style.display = "none"; }
      var links = document.getElementsByClassName("top-tablinks");
      for (var i = 0; i < links.length; i++) { links[i].className = links[i].className.replace(" active", ""); }
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
    }

    function openSubTab(evt, subTabName) {
      var container = evt.currentTarget.parentNode.parentNode;
      var contents = container.getElementsByClassName("sub-tabcontent");
      for (var i = 0; i < contents.length; i++) { contents[i].style.display = "none"; }
      var links = container.getElementsByClassName("sub-tablinks");
      for (var i = 0; i < links.length; i++) { links[i].className = links[i].className.replace(" active", ""); }
      document.getElementById(subTabName).style.display = "block";
      evt.currentTarget.className += " active";
    }

    // Date Functions
    function populateDaySelector() {
      var daySelector = document.getElementById("daySelector");
      var monthSelector = document.getElementById("monthSelector");
      var yearSelector = document.getElementById("yearSelector");

      var selectedMonth = parseInt(monthSelector.value);
      var selectedYear = parseInt(yearSelector.value);
      var daysInMonth = new Date(selectedYear, selectedMonth, 0).getDate();

      daySelector.innerHTML = "";
      for (var i = 1; i <= daysInMonth; i++) {
        var option = document.createElement("option");
        option.value = i;
        option.textContent = i;
        daySelector.appendChild(option);
      }

      var today = new Date();
      if (selectedMonth === today.getMonth() + 1 && selectedYear === today.getFullYear()) {
        daySelector.value = today.getDate();
      } else {
        daySelector.value = 1;
      }
    }

    function initializeDateSelectors() {
      var today = new Date();
      document.getElementById("monthSelector").value = today.getMonth() + 1;
      document.getElementById("yearSelector").value = today.getFullYear();
      populateDaySelector();

      document.getElementById("monthSelector").addEventListener("change", populateDaySelector);
      document.getElementById("yearSelector").addEventListener("change", populateDaySelector);
    }

    function getSelectedDate() {
      var day = parseInt(document.getElementById("daySelector").value);
      var month = parseInt(document.getElementById("monthSelector").value);
      var year = parseInt(document.getElementById("yearSelector").value);
      return new Date(year, month - 1, day);
    }

    // Sample data for demonstration
    const sampleData = [
      { Code: "001", Appellation: "Situation Comptable provisoire", Frequency: "Mensuelle", Transmission: "TÃ©lÃ©transmission", DeadlineRule: "12 jours aprÃ¨s la date d'arrÃªtÃ©" },
      { Code: "005", Appellation: "Ventilation des opÃ©rations de trÃ©sorerie", Frequency: "Mensuelle", Transmission: "TÃ©lÃ©transmission", DeadlineRule: "12 jours aprÃ¨s la date d'arrÃªtÃ©" },
      { Code: "040", Appellation: "Bilan", Frequency: "Semestrielle", Transmission: "TÃ©lÃ©transmission", DeadlineRule: "30 avril pour le dÃ©finitif" }
    ];

    function formatDate(date) {
      if (!(date instanceof Date)) return "N/A";
      var day = ("0" + date.getDate()).slice(-2);
      var month = ("0" + (date.getMonth() + 1)).slice(-2);
      var year = date.getFullYear();
      return day + "/" + month + "/" + year;
    }

    function addDays(date, days) {
      var result = new Date(date);
      result.setDate(result.getDate() + days);
      return result;
    }

    function updateSampleTable() {
      var tbody = document.getElementById("upcoming-table-cat1");
      if (!tbody) return;

      tbody.innerHTML = "";
      var now = new Date();

      sampleData.forEach(function(item) {
        var tr = document.createElement("tr");

        var tdCode = document.createElement("td");
        tdCode.textContent = item.Code;
        tr.appendChild(tdCode);

        var tdApp = document.createElement("td");
        tdApp.textContent = item.Appellation;
        tr.appendChild(tdApp);

        var tdFreq = document.createElement("td");
        tdFreq.textContent = item.Frequency;
        tr.appendChild(tdFreq);

        var tdTrans = document.createElement("td");
        tdTrans.textContent = item.Transmission;
        tr.appendChild(tdTrans);

        var tdRule = document.createElement("td");
        tdRule.textContent = item.DeadlineRule;
        tr.appendChild(tdRule);

        var tdArrete = document.createElement("td");
        tdArrete.textContent = formatDate(new Date(2025, 0, 31)); // Sample date
        tr.appendChild(tdArrete);

        var tdDeadline = document.createElement("td");
        var deadline = addDays(new Date(2025, 0, 31), 12);
        tdDeadline.textContent = formatDate(deadline);
        tr.appendChild(tdDeadline);

        var tdDays = document.createElement("td");
        var daysRemaining = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));
        tdDays.textContent = daysRemaining;
        tr.appendChild(tdDays);

        tbody.appendChild(tr);
      });
    }

    // Download function (simplified)
    function downloadTableAsImage(tableId) {
      alert("Download functionality requires html2canvas library. This is a demo version.");
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      initializeDateSelectors();

      document.getElementById("updateDateButton").addEventListener("click", function() {
        updateSampleTable();
        alert("Date updated to: " + formatDate(getSelectedDate()));
      });

      document.getElementById("uploadButton").addEventListener("click", function() {
        var file = document.getElementById("fileInput").files[0];
        if (file) {
          document.getElementById("uploadStatus").textContent = "File uploaded: " + file.name;
        } else {
          document.getElementById("uploadStatus").textContent = "Please select a file.";
        }
      });

      // Set default active tabs
      document.getElementById("defaultTopTab").click();
      document.getElementById("defaultSubTab_cat1").click();

      // Load sample data
      updateSampleTable();
    });
  </script>
</body>
</html>
